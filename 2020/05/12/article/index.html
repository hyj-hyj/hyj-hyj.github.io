<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="http://yoursite.com">
  <title>httpclient的使用</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="article">
<meta property="og:title" content="myTest">
<meta property="og:url" content="http://yoursite.com/2019/12/26/myTest/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2019-12-26T09:25:53.000Z">
<meta property="article:modified_time" content="2019-12-26T09:25:53.612Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" type="text/css" href="/./main.0cf68a.css">
  <style type="text/css">
  
    #container.show {
      background: linear-gradient(200deg,#a0cfe4,#e8c37e);
    }
    .mid-col {
    position: absolute;
    right: 0;
    min-height: 100%;
    background: white;
    left: 0px;
    width: auto;
}

    .myTable{
    border-collapse:collapse;
    border-top:1px solid #8c9594;
    border-right:1px solid #8c9594;
    font-size:12px;
    color:#333;
    width:100%;
    text-align: left;
 
    }
/**---table下面所有的td---**/
.myTable tr td{
    border-left:1px solid #8c9594;
    border-bottom:1px solid #8c9594;
    padding:5px 0 5px 5px;
    width: 50%;
}
  
/*.listTable tr td:first-child{
    text-align:right;
    width:100px;
  
}*/
 
 .myTable tr td:nth-child(1),td:nth-child(3),td:nth-child(5)
{
    text-align:right;
}
  </style>
  

  <script>
    var yiliaConfig = {
      mathjax: false,
      isHome: false,
      isPost: true,
      isArchive: false,
      isTag: false,
      isCategory: false,
      open_in_new: false,
      toc_hide_index: true,
      root: "/",
      innerArchive: true,
      showTags: false
    }
  </script>

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
    <!--右侧正文开始-->
    <div class="mid-col" q-class="show:isShow,hide:isShow|isFalse">
      <div id="wrapper" class="body-wrap">
        <div class="menu-l">
            <div class="article-inner">
            
              <header class="article-header">
                <h1 class="article-title" itemprop="name">
                  httpclient的使用
                </h1>
              
                <a href="/2019/12/26/myTest/" class="archive-article-date">
                    <time datetime="2019-12-26T09:25:53.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2020-05-12</time>
                </a>
              </header>


              <div class="page-reward">
                  <div class="tooltip tooltip-east" style="text-align: left;">
                    <p> <span style="color: red;">1.&nbsp;使用apache的httpclient的大致步骤：</span>
                      <ul>

                        <li>(1)使用HttpClients的createDefault()方法创建CloseableHttpClient对象。</li>
                        <li>(2)基于要发送的HTTP请求类型创建HttpGet或者HttpPost请求实例。</li>
                        <li>(3)使用addHeader方法设置content_type类型和字符集。如果有需要还可以设置代理</li>
                        <li>(4)对于POST请求,创建NameValuePair列表,并添加所有的表单参数.然后把它填充进HttpPost实体.。</li>
                        <li>(5)通过执行CloseableHttpClient对象的实例的execute()方法获取CloseableHttpResponse对象。</li>
                        <li>(6)从CloseableHttpResponse实例中获取状态码,错误信息,以及响应页面等等。</li>
                        <li>(7)最后关闭HttpClient资源。</li>
  
                      </ul>
                    </p> 
                    

                    <p><span style="color: red;"> 2.&nbsp;代码实例：</span>
<pre >
  <span style="color: red;">
(1)post请求以表单方式提交参数：</span>
public static String httpClientDoPost(String url, Map<String,Object> params) {
    String res = "";
    try{
        //创建CloseableHttpClient对象
        CloseableHttpClient httpclient = HttpClients.createDefault();
        //创建httpost实例
        HttpPost httpPost = new HttpPost(url);
        //设置代理
        /*HttpHost proxy = new HttpHost(ConstantProperties.getProxyIp(), ConstantProperties.getProxyPort(), "https");
        RequestConfig config = RequestConfig.custom()
                .setProxy(proxy)
                .build();
        httpPost.setConfig(config);*/
        //设置content_type类型
        httpPost.addHeader("Content-Type", "application/x-www-form-urlencoded;charset=UTF-8");
        //解析需要传递的参数
        List<NameValuePair> formparams = new ArrayList<>();
        for (Map.Entry<String, Object> entry : params.entrySet()) {
            formparams.add(new BasicNameValuePair(entry.getKey(), String.valueOf(entry.getValue())));
        }
        //参数转码
        UrlEncodedFormEntity uefEntity = new UrlEncodedFormEntity(formparams, "UTF-8");
        httpPost.setEntity(uefEntity);
        HttpResponse response = httpclient.execute(httpPost);
        //获取状态值
        int status = response.getStatusLine().getStatusCode();
        HttpEntity entity = response.getEntity();
        if(entity != null){
            res = EntityUtils.toString(entity);
        }
    }catch (Exception e){
        e.printStackTrace();
    }
    return res;
}

<span style="color: red;">
(2)post请求以json方式提交参数：</span>
public static String httpClientPostJson(String url, String json){
  //创建默认的httpClient实例.
  CloseableHttpClient httpclient = null;
  //接收响应结果
  CloseableHttpResponse response = null;
  try {
      List<NameValuePair> params = new ArrayList<>();
      //创建httppost
      httpclient = HttpClients.createDefault();
      HttpPost httpPost = new HttpPost(url);
      /*HttpHost proxy = new HttpHost(ConstantProperties.getProxyIp(), ConstantProperties.getProxyPort(), "http");
      RequestConfig config = RequestConfig.custom()
              .setProxy(proxy)
              .build();
      httpPost.setConfig(config);*/
      httpPost.addHeader(HTTP.CONTENT_TYPE, "application/json;charset=UTF-8");
      //参数
      StringEntity se = new StringEntity(json, "UTF-8");
      se.setContentEncoding("UTF-8");
      se.setContentType("application/json");//发送json需要设置contentType
      httpPost.setEntity(se);
      response = httpclient.execute(httpPost);
      //获取状态值
      int status = response.getStatusLine().getStatusCode();
      if(status != 200){
          return null;
      }
      //解析返结果
      HttpEntity entity = response.getEntity();
      if(entity != null){
          String returnStr = EntityUtils.toString(entity, "UTF-8");
          return returnStr;
      }
  } catch (Exception e) {
      e.printStackTrace();
      return e.getMessage();
  }
  return null;
}
<span style="color: red;">
(3)get请求以完整地址提交：</span>
public static String httpClientGetUrl(String url) {
  CloseableHttpClient httpclient = null;
  CloseableHttpResponse response = null;
  try {
      httpclient = HttpClients.createDefault();
      // 创建httpget.
      HttpGet httpget = new HttpGet(url);
      response = httpclient.execute(httpget);
      //获取状态值
      int status = response.getStatusLine().getStatusCode();
      if(status != 200){
          return null;
      }
      // 获取响应实体
      HttpEntity entity = response.getEntity();
      if (entity != null) {
          // 得到响应内容
          return EntityUtils.toString(entity);
      }
  } catch (Exception e) {
      e.printStackTrace();
  }
  return null;
}
<span style="color: red;">
(4)通过URL对象以get方式请求：</span>
public static String httpURLGet(String address) {
  HttpURLConnection httpURLConnection = null;
  String msg = "";
  try {
      // 1. 得到访问地址的URL
      URL url = new URL(address);
      // 2. 得到网络访问对象java.net.HttpURLConnection
      httpURLConnection = (HttpURLConnection) url.openConnection();
      /* 3. 设置请求参数（过期时间，输入、输出流、访问方式），以流的形式进行连接 */
      // 设置是否向HttpURLConnection输出
      httpURLConnection.setDoOutput(false);
      // 设置是否从httpUrlConnection读入
      httpURLConnection.setDoInput(true);
      // 设置请求方式　默认为GET
      httpURLConnection.setRequestMethod("GET");
      // 设置是否使用缓存
      httpURLConnection.setUseCaches(true);
      // 设置此 HttpURLConnection 实例是否应该自动执行 HTTP 重定向
      httpURLConnection.setInstanceFollowRedirects(true);
      // 设置超时时间
      httpURLConnection.setConnectTimeout(10000);
      // 连接
      httpURLConnection.connect();
      // 4. 得到响应状态码的返回值 responseCode
      int code = httpURLConnection.getResponseCode();
      // 5. 如果返回值正常，数据在网络中是以流的形式得到服务端返回的数据

      if (code == 200) { // 正常响应
          // 从流中读取响应信息
          BufferedReader reader = new BufferedReader(new InputStreamReader(httpURLConnection.getInputStream()));
          String line = null;
          while ((line = reader.readLine()) != null) { // 循环从流中读取
              //msg += line + "\n";
              msg += line ;
          }
          reader.close(); // 关闭流
      }
      // 显示响应结果
      System.out.println(msg);
  } catch (Exception e) {
      System.out.println("转发出错，错误信息："+e.getLocalizedMessage()+";"+e.getClass());
  }finally {
      // 6. 断开连接，释放资源
      if (null != httpURLConnection){
          try {
              httpURLConnection.disconnect();
          }catch (Exception e){
              System.out.println("httpURLConnection 流关闭异常："+ e.getLocalizedMessage());
          }
      }
  }
  return msg;
}

</pre>
                   
                   
                </div>
              </div>
      
            </div>






  
              <!--尾部信息-->

              

              <nav id="article-nav">

                  <a href="/" id="article-nav-newer" class="article-nav-link-wrap">
                    <i class="icon-circle-left"></i>
                    <div class="article-nav-title"> 首页</div>
                  </a>
                
             
                  <a href="/2019/12/26/myTest/" id="article-nav-older" class="article-nav-link-wrap">
                    <div class="article-nav-title">idea中的快捷键</div>
                    <i class="icon-circle-right"></i>
                  </a>
                
              </nav>


              <hr>


              <footer id="footer">
                <div class="outer">
                  <div id="footer-info">
                    <div class="footer-left">
                      &copy; 2020 黄亚军
                    </div>
                      <div class="footer-right">
                        <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
                      </div>
                  </div>
                </div>
              </footer>

          </div>
        </div>
      </div>
      <!--右侧正文结束-->

</body>
</html>